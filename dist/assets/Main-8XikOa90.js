import{d as W,r as f,u as G,c as ee,F as te,a as u,b as w,w as a,o as m,e as E,t as M,f as F,g as _,h as g,E as J,_ as le,i as ie,j as re,k as S,l as ue,m as b,v as ce,n as de,p as pe,q as me,s as fe,x as ve,y as _e}from"./index-CnQ5Sg1B.js";import{i as Q,A as ye,a as ge,b as ke,c as we,d as Y,e as Z,f as Ce,g as Ve,h as be,j as he,k as xe,l as Ne}from"./api-BUtp0CYo.js";import{_ as $e}from"./UploadScore.vue_vue_type_script_setup_true_lang-CP1pGWmg.js";const Ae={style:{flex:"auto"}},De=W({__name:"LoginDrawer",props:{status:{type:Function},statusModifiers:{}},emits:["update:status"],setup(L){const k=f(!1),C=f(""),c=f(""),s=f(!1),j=f("修改密码"),d=f("登录"),V=f(Q()?"退出":"管理"),y=G(L,"status"),B=()=>{Q()?(ye(),V.value="管理",y.value&&y.value(!1)):k.value=!0},N=async()=>{s.value?(await ge(C.value,c.value).catch(K),O("修改成功"),$()):(await ke(C.value).catch(K),O("登录成功"),k.value=!1,V.value="退出",y.value&&y.value(!0))},$=()=>{s.value=!s.value,j.value=s.value?"返回":"修改密码",d.value=s.value?"修改":"登录"},O=(P="更新成功！")=>{J({message:P,type:"success"})},K=async P=>(J({message:"密码错误",type:"error"}),Promise.reject(P));return(P,A)=>{const z=w("el-button"),U=w("el-input"),R=w("el-space"),q=w("el-drawer");return m(),ee(te,null,[u(z,{type:"warning",class:"global-float-button",onClick:B},{default:a(()=>[E(M(V.value),1)]),_:1}),u(q,{modelValue:k.value,"onUpdate:modelValue":A[2]||(A[2]=I=>k.value=I),title:"请先登录!",direction:"btt"},{default:a(()=>[u(R,null,{default:a(()=>[u(U,{type:"password",placeholder:"登录密码",modelValue:C.value,"onUpdate:modelValue":A[0]||(A[0]=I=>C.value=I),"show-password":""},null,8,["modelValue"]),s.value?(m(),_(U,{key:0,placeholder:"新密码",modelValue:c.value,"onUpdate:modelValue":A[1]||(A[1]=I=>c.value=I)},null,8,["modelValue"])):g("",!0)]),_:1})]),footer:a(()=>[F("div",Ae,[u(z,{type:"info",onClick:$},{default:a(()=>[E(M(j.value),1)]),_:1}),u(z,{type:"primary",onClick:N},{default:a(()=>[E(M(d.value),1)]),_:1})])]),_:1},8,["modelValue"])],64)}}}),Se={class:"dialog-footer"},Ee=W({__name:"ConfirmDialog",props:{isVisible:{type:Boolean},isVisibleModifiers:{},content:{type:String,default:"请确认"},contentModifiers:{},confirm:{type:Function},confirmModifiers:{}},emits:["update:isVisible","update:content","update:confirm"],setup(L){const k=G(L,"isVisible"),C=G(L,"content"),c=G(L,"confirm"),s=()=>{k.value=!1,c.value&&c.value()};return(j,d)=>{const V=w("el-button"),y=w("el-dialog");return m(),_(y,{modelValue:k.value,"onUpdate:modelValue":d[2]||(d[2]=B=>k.value=B),title:"提醒","align-center":"",center:""},{footer:a(()=>[F("span",Se,[u(V,{onClick:d[0]||(d[0]=B=>k.value=!1)},{default:a(()=>d[3]||(d[3]=[E("取消")])),_:1}),u(V,{type:"primary",onClick:d[1]||(d[1]=B=>s())},{default:a(()=>d[4]||(d[4]=[E(" 确认 ")])),_:1})])]),default:a(()=>[F("span",null,M(C.value),1)]),_:1},8,["modelValue"])}}}),Be=le(Ee,[["__scopeId","data-v-75ed8409"]]),Ie={class:"main"},Me={class:"row"},Le=W({__name:"Main",setup(L){const k={children:"songs",label:"name",class:({category:e})=>e?"song":"category"},C=f(),c=()=>C.value,s=f([]);ie(async()=>{C.value=Q(),d()});const j=e=>{C.value=e,e?d():s.value&&(s.value=s.value.filter(t=>t.is_show==1))},d=async()=>{await we().then(e=>{s.value=e}).catch(h)},V=f(""),y=f();re(V,e=>{y.value.filter(e)});const B=(e,t)=>e?t.name.includes(e):!0,N=f(""),$=f(""),O=e=>{$.value=e.id,N.value=e.name},K=async(e,t)=>{var o;const r=e.level==1?Y:Z,{score:l}=await r(e.data.id,{name:N.value}).catch(h);t.name=N.value,t.score=l,$.value="",e.level==1&&((o=t.songs)==null||o.map(p=>p.category=t.name)),H()},P=async e=>{const t=e.is_show==1?0:1;await Y(e.id,{is_show:t}).catch(h),H(`更新成功，此分类${e.is_show?"将在前台显示":"不再显示"}`),e.is_show=t},A=async(e,t)=>{const r=await Ce("新目录",t.order_num+1).catch(h);r.songs=[];const l=s.value.findIndex(o=>o.id===t.id);s.value.map(o=>{o.order_num>t.order_num&&(o.order_num+=1)}),s.value.splice(l+1,0,r),T()},z=async(e,t)=>{var D,i;const r=e.level===1?1:t.order_num+1,l=t.category||t.name,o=await Ve("新歌曲",l,r).catch(h),p=e.level==1?t.songs:(D=e.parent)==null?void 0:D.data.songs,v=p.findIndex(n=>n.id===t.id);p.splice(v+1,0,o),T(l),(i=y.value)==null||i.setCurrentKey(o.id)},U=f(!1),R=f("确认删除该目录或歌曲？");let q=null;const I=e=>{q=e,R.value=`确认删除【${e.label}】${e.level==1?"及其下所有":""}？`,U.value=!0},ne=async(e=q)=>{var o,p,v,D;U.value=!1;const t=e.level==1?s.value:(o=e.parent)==null?void 0:o.data.songs;await(e.level==1?be:he)(e.data.id).catch(h);const l=t.findIndex(i=>i.id===e.data.id);t.splice(l,1),s.value=[...s.value],t.length?(p=y.value)==null||p.setCurrentKey(t[0].id):(D=y.value)==null||D.setCurrentKey((v=e.parent)==null?void 0:v.id),T(e.data.category)},se=async(e,t)=>{if(e.level==1){const v=T();return v&&await xe(v.ids,v.order_nums).catch(h),H()}const r=e.data.category,l=t.data.category,{ids:o,order_nums:p}=T(l);if(r!=l){const v=T(r);o.push(...v.ids),p.push(...v.order_nums),e.data.category=l,await Z(e.data.id,{category:l}).catch(h)}await Ne(o,p).catch(h),H(),console.log("treeData:",s.value)},T=(e="")=>{var r;const t=(e?(r=s.value.find(l=>l.name==e))==null?void 0:r.songs:s.value)||[];return t.forEach((l,o)=>l.order_num=o+1),{ids:t.map(l=>l.id),order_nums:t.map(l=>l.order_num)}},oe=e=>{var t;return(((t=e.parent)==null?void 0:t.childNodes.length)||0)>1||e.level!=1},ae=(e,t,r)=>e.level===t.level?r!=="inner":r==="inner";async function h(e){return J({message:e.msg,type:"warning"}),Promise.reject(e)}function H(e="更新成功！"){J({message:e,type:"success"})}return(e,t)=>{var D;const r=w("el-input"),l=w("el-button"),o=w("el-text"),p=w("el-space"),v=w("router-link");return m(),ee(te,null,[u(De,{status:j}),u(Be,{isVisible:U.value,content:R.value,confirm:ne},null,8,["isVisible","content"]),F("div",Ie,[u(r,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=i=>V.value=i),placeholder:"查找歌曲或目录",class:"filter"},null,8,["modelValue"]),u(S(ue),{data:s.value,props:k,"allow-drop":ae,"allow-drag":oe,"filter-node-method":B,"expand-on-click-node":!0,"default-expanded-keys":[(D=s.value[0])==null?void 0:D.id],accordion:!c(),"empty-text":"无数据",draggable:c(),ref_key:"treeRef",ref:y,"node-key":"id",icon:"a",onNodeDrop:se},{default:a(({node:i,data:n})=>[F("div",Me,[u(p,null,{default:a(()=>[c()&&!n.category?(m(),_(l,{key:0,type:"warning",link:"",icon:n.is_show==1?S(ce):S(de),onClick:b(x=>P(n),["stop"])},null,8,["icon","onClick"])):g("",!0),u(p,{size:0},{default:a(()=>[$.value!=n.id?(m(),_(o,{key:0,truncated:""},{default:a(()=>[E(M(i.label),1)]),_:2},1024)):g("",!0),c()&&$.value!=n.id?(m(),_(l,{key:1,icon:S(pe),type:"primary",link:"",onClick:b(x=>O(n),["stop"])},null,8,["icon","onClick"])):g("",!0),c()&&$.value==n.id?(m(),_(r,{key:2,modelValue:N.value,"onUpdate:modelValue":t[1]||(t[1]=x=>N.value=x),onInput:N.value,onClick:t[2]||(t[2]=b(()=>{},["stop"])),class:"title"},{append:a(()=>[u(l,{icon:S(me),onClick:b(x=>K(i,n),["stop"])},null,8,["icon","onClick"])]),_:2},1032,["modelValue","onInput"])):g("",!0)]),_:2},1024)]),_:2},1024),u(p,null,{default:a(()=>[u(p,null,{default:a(()=>[i.level!=1&&!n.score&&c()?(m(),_($e,{key:0,class:"upload",btnName:c()?"谱":"歌谱",btnType:"info",isBtnLink:!0,onClick:t[3]||(t[3]=b(()=>{},["stop"])),name:n.name,id:n.id,path:n.score,onSuccess:x=>n.score=x},null,8,["btnName","name","id","path","onSuccess"])):g("",!0),i.level!=1&&n.score?(m(),_(v,{key:1,to:{name:"Score",state:{song:{id:n.id,name:n.name,score:n.score,is_extend:n.is_extend}}},onClick:t[4]||(t[4]=b(()=>{},["stop"]))},{default:a(()=>[u(o,{type:"primary"},{default:a(()=>[E(M(c()?"":"歌")+"谱",1)]),_:1})]),_:2},1032,["to"])):g("",!0),i.level!=1&&(c()||n.is_lyrics)?(m(),_(v,{key:2,to:{name:"Lyrics",params:{id:n.id}},onClick:t[5]||(t[5]=b(()=>{},["stop"]))},{default:a(()=>[u(o,{type:n.is_lyrics?"primary":"info"},{default:a(()=>[E(M(c()?"":"歌")+"词",1)]),_:2},1032,["type"])]),_:2},1032,["to"])):g("",!0)]),_:2},1024),c()?(m(),_(p,{key:0},{default:a(()=>{var x;return[i.level==1?(m(),_(l,{key:0,size:"small",type:"primary",icon:S(fe),onClick:[X=>A(i,n),t[6]||(t[6]=b(()=>{},["stop"]))]},null,8,["icon","onClick"])):g("",!0),i.level==1&&!i.childNodes.length||i.level==2?(m(),_(l,{key:1,size:"small",type:"success",icon:S(ve),circle:"",onClick:[X=>z(i,n),t[7]||(t[7]=b(()=>{},["stop"]))]},null,8,["icon","onClick"])):g("",!0),i.level!=1||((x=i.parent)==null?void 0:x.childNodes.length)>1?(m(),_(l,{key:2,size:"small",type:"danger",icon:S(_e),circle:"",onClick:[X=>I(i),t[8]||(t[8]=b(()=>{},["stop"]))]},null,8,["icon","onClick"])):g("",!0)]}),_:2},1024)):g("",!0)]),_:2},1024)])]),_:1},8,["data","default-expanded-keys","accordion","draggable"])])],64)}}}),je=le(Le,[["__scopeId","data-v-582f2603"]]);export{je as default};
