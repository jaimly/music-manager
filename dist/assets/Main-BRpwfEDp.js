import{d as h,u as U,c as m,w as a,a as z,t as q,b as f,r as V,e as A,o as d,f as b,g as ee,A as te,h as ne,E as H,i as le,j as v,k as c,l as I,m as y,v as oe,n as se,p as ie,q as ae,s as re,x as ue,y as ce,z as de,F as pe,B as me,C as fe,D as P,G as R,H as ve,I as ye}from"./index-CbvSRP9N.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as ge}from"./UploadScore.vue_vue_type_script_setup_true_lang-DLOnl4Qo.js";const _e={class:"dialog-footer"},ke=h({__name:"ConfirmDialog",props:{isVisible:{type:Boolean,default:!1},isVisibleModifiers:{},content:{type:String,default:"请确认"},contentModifiers:{},confirm:{type:Function},confirmModifiers:{}},emits:["update:isVisible","update:content","update:confirm"],setup(E){const x=U(E,"isVisible"),r=U(E,"content"),$=U(E,"confirm"),_=()=>{x.value=!1,$.value&&$.value()};return(K,o)=>{const k=V("el-button"),M=V("el-dialog");return d(),m(M,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=S=>x.value=S),title:"提醒","align-center":"",center:""},{footer:a(()=>[z("span",_e,[f(k,{onClick:o[0]||(o[0]=S=>x.value=!1)},{default:a(()=>o[3]||(o[3]=[A("取消")])),_:1}),f(k,{type:"primary",onClick:o[1]||(o[1]=S=>_())},{default:a(()=>o[4]||(o[4]=[A(" 确认 ")])),_:1})])]),default:a(()=>[z("span",null,q(r.value),1)]),_:1},8,["modelValue"])}}}),Ce=G(ke,[["__scopeId","data-v-5485ce58"]]),we={class:"main"},be=h({__name:"Main",setup(E){const x={children:"songs",label:"name",class:({category:t})=>t?"song":"category"},r=b([]);ee(async()=>{await te().then(t=>{r.value=t}).catch(D)});const $=b(""),_=b();ne($,t=>{_.value.filter(t)});const K=(t,e)=>t?e.name.includes(t):!0,o=b(""),k=b(""),M=t=>{k.value=t.id,o.value=t.name},S=async(t,e)=>{await(t.level==1?P:R)(t.data.id,{name:o.value}).catch(D),T(),e.name=o.value,k.value=""},O=async t=>{const e=t.is_show==1?0:1;await P(t.id,{is_show:e}).catch(D),T(`更新成功，此分类${t.is_show?"将在前台显示":"不再显示"}`),t.is_show=e},J=async(t,e)=>{var p;const i=await me("新目录",e.order_num+1).catch(D);i.songs=[];const u=r.value.findIndex(s=>s.id===e.id);r.value.map(s=>{s.order_num>e.order_num&&(s.order_num+=1)}),r.value.splice(u+1,0,i),r.value=[...r.value],(p=_.value)==null||p.setCurrentKey(i.id)},Q=async(t,e)=>{var C,n;const i=t.level===1?1:e.order_num+1,u=e.category||e.name,p=await fe("新歌曲",u,i).catch(D),s=t.level==1?e.songs:(C=t.parent)==null?void 0:C.data.songs,w=s.findIndex(l=>l.id===e.id);s.map(l=>{l.order_num>e.order_num&&(l.order_num+=1)}),s.splice(w+1,0,p),r.value=[...r.value],(n=_.value)==null||n.setCurrentKey(p.id)},N=b(!1),B=b("确认删除该目录或歌曲？");let L=null;const W=t=>{L=t,B.value=`确认删除【${t.label}】${t.level==1?"及其下所有":""}？`,N.value=!0},F=async(t=L)=>{var p,s,w,C;const e=t.level==1?r.value:(p=t.parent)==null?void 0:p.data.songs;await(t.level==1?ve:ye)(t.data.id).catch(D);const u=e.findIndex(n=>n.id===t.data.id);e.splice(u,1),r.value=[...r.value],e.length?(s=_.value)==null||s.setCurrentKey(e[0].id):(C=_.value)==null||C.setCurrentKey((w=t.parent)==null?void 0:w.id)},X=async(t,e,i)=>{const u={category:e.data.category||e.data.name,order_num:i!="inner"&&(i=="before"?e.data.order_num:e.data.order_num+1)||void 0};await R(t.data.id,u)},Y=t=>{var e;return(((e=t.parent)==null?void 0:e.childNodes.length)||0)>1||t.level!=1},Z=(t,e,i)=>t.level===e.level?i!=="inner":i==="inner";async function D(t){return H({message:t.msg,type:"warning"}),Promise.reject(t)}function T(t="更新成功！"){H({message:t,type:"success"})}return(t,e)=>{var C;const i=V("el-input"),u=V("el-button"),p=V("el-text"),s=V("el-space"),w=V("router-link");return d(),le(pe,null,[f(Ce,{isVisible:N.value,"onUpdate:isVisible":e[0]||(e[0]=n=>N.value=n),content:B.value,"onUpdate:content":e[1]||(e[1]=n=>B.value=n),confirm:F,"onUpdate:confirm":e[2]||(e[2]=n=>F=n)},null,8,["isVisible","content"]),z("div",we,[f(i,{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=n=>$.value=n),placeholder:"查找歌曲或目录",class:"filter"},null,8,["modelValue"]),f(c(de),{data:r.value,props:x,"allow-drop":Z,"allow-drag":Y,"filter-node-method":K,"expand-on-click-node":!0,"default-expanded-keys":[(C=r.value[0])==null?void 0:C.id],draggable:"",accordion:!c(I)(),ref_key:"treeRef",ref:_,"node-key":"id",icon:"a",onNodeDrop:X},{default:a(({node:n,data:l})=>[f(s,null,{default:a(()=>[f(s,null,{default:a(()=>[c(I)()&&!l.category?(d(),m(u,{key:0,type:"warning",link:"",icon:l.is_show==1?c(oe):c(se),onClick:y(g=>O(l),["stop"])},null,8,["icon","onClick"])):v("",!0),f(s,{size:0},{default:a(()=>[k.value!=l.id?(d(),m(p,{key:0,truncated:""},{default:a(()=>[A(q(n.label),1)]),_:2},1024)):v("",!0),c(I)()&&k.value!=l.id?(d(),m(u,{key:1,icon:c(ie),type:"primary",link:"",onClick:y(g=>M(l),["stop"])},null,8,["icon","onClick"])):v("",!0),c(I)()&&k.value==l.id?(d(),m(i,{key:2,modelValue:o.value,"onUpdate:modelValue":e[4]||(e[4]=g=>o.value=g),onInput:o.value,onClick:e[5]||(e[5]=y(()=>{},["stop"])),class:"title"},{append:a(()=>[f(u,{icon:c(ae),onClick:y(g=>S(n,l),["stop"])},null,8,["icon","onClick"])]),_:2},1032,["modelValue","onInput"])):v("",!0)]),_:2},1024)]),_:2},1024),f(s,null,{default:a(()=>[n.level!=1&&!l.score&&c(I)()?(d(),m(ge,{key:0,class:"upload",btnName:"谱",btnType:"info",isBtnLink:!0,onClick:e[6]||(e[6]=y(()=>{},["stop"])),name:l.name,id:l.id,onSuccess:g=>l.score=g},null,8,["name","id","onSuccess"])):v("",!0),n.level!=1&&l.score?(d(),m(w,{key:1,to:{name:"Score",state:{song:{id:l.id,name:l.name,score:l.score}}},onClick:e[7]||(e[7]=y(()=>{},["stop"]))},{default:a(()=>[f(p,{type:"primary"},{default:a(()=>e[12]||(e[12]=[A("谱")])),_:1})]),_:2},1032,["to"])):v("",!0),n.level!=1?(d(),m(w,{key:2,to:{name:"Lyrics",params:{id:l.id}},onClick:e[8]||(e[8]=y(()=>{},["stop"]))},{default:a(()=>[f(p,{type:"primary"},{default:a(()=>e[13]||(e[13]=[A("词")])),_:1})]),_:2},1032,["to"])):v("",!0)]),_:2},1024),c(I)()?(d(),m(s,{key:0},{default:a(()=>{var g;return[n.level==1?(d(),m(u,{key:0,size:"small",type:"primary",icon:c(re),onClick:[j=>J(n,l),e[9]||(e[9]=y(()=>{},["stop"]))]},null,8,["icon","onClick"])):v("",!0),n.level==1&&!n.childNodes.length||n.level==2?(d(),m(u,{key:1,size:"small",type:"success",icon:c(ue),circle:"",onClick:[j=>Q(n,l),e[10]||(e[10]=y(()=>{},["stop"]))]},null,8,["icon","onClick"])):v("",!0),n.level!=1||((g=n.parent)==null?void 0:g.childNodes.length)>1?(d(),m(u,{key:2,size:"small",type:"danger",icon:c(ce),circle:"",onClick:[j=>W(n),e[11]||(e[11]=y(()=>{},["stop"]))]},null,8,["icon","onClick"])):v("",!0)]}),_:2},1024)):v("",!0)]),_:2},1024)]),_:1},8,["data","default-expanded-keys","accordion"])])],64)}}}),De=G(be,[["__scopeId","data-v-03178b38"]]);export{De as default};
