import{n as A,o as L,e as U,p as E}from"./api-BUtp0CYo.js";import{d as j,r as v,u as a,g as D,b as S,k as d,E as r,w as h,a as q,e as V,t as z,A as I,o as P}from"./index-CnQ5Sg1B.js";const H=j({__name:"UploadScore",props:{id:{type:String,required:!0},idModifiers:{},name:{type:String,required:!0},nameModifiers:{},path:{type:String},pathModifiers:{},extend:{type:Number},extendModifiers:{},btnName:{type:String,default:"更换"},btnNameModifiers:{},btnClass:{type:String},btnClassModifiers:{},btnType:{type:String,default:"primary"},btnTypeModifiers:{},isBtnLink:{type:Boolean,default:!1},isBtnLinkModifiers:{},onSuccess:{type:Function},onSuccessModifiers:{}},emits:["update:id","update:name","update:path","update:extend","update:btnName","update:btnClass","update:btnType","update:isBtnLink","update:onSuccess"],setup(t){const k=v(window.localStorage.getItem("password")),o=v(!1),c=a(t,"id"),p=a(t,"name"),i=a(t,"path"),l=a(t,"extend"),x=a(t,"btnName"),M=a(t,"btnClass"),w=a(t,"btnType"),B=a(t,"isBtnLink"),m=a(t,"onSuccess"),C=async(e,b,s)=>{var y;if(f(s),e.ok)return u(e);const n=(y=e.data)==null?void 0:y.path,F=l.value?{is_extend:1}:{score:n};await U(c.value,F).catch(async T=>{var g;return await E((g=e.data)==null?void 0:g.id),u(T)}),i.value=n,m.value&&m.value(n),r({message:"更新成功！",type:"success"})},N=(e,b,s)=>{f(s),console.trace(e),u({msg:`上传失败：${p.value}`})},f=e=>{e.splice(0,1),o.value=!1};async function u(e){return r({message:e.msg,type:"error"}),Promise.reject(e)}return(e,b)=>{const s=S("el-button"),n=S("el-upload");return P(),D(n,{action:!i.value||l.value?d(A)():d(L)(),accept:".jpg,.jpeg,.png",limit:1,"show-file-list":!1,"auto-upload":!0,headers:{password:k.value},data:{id:c.value,name:p.value,category:"score",path:i.value,extend:l.value},"on-success":C,"on-error":N,"before-upload":()=>(d(r)({message:"开始上传，请等候...",type:"info"}),o.value=!0,!0)},{default:h(()=>[q(s,{type:w.value,class:I(M.value),link:B.value,disabled:o.value},{default:h(()=>[V(z(x.value),1)]),_:1},8,["type","class","link","disabled"])]),_:1},8,["action","headers","data","before-upload"])}}});export{H as _};
