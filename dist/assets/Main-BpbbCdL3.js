import{d as J,r as m,u as H,c as Z,F as ee,a,b as k,w as o,o as p,e as D,t as E,f as F,g as f,h as y,E as O,_ as te,i as ae,j as ie,k as A,l as ue,m as V,v as re,n as ce,p as de,q as pe,s as me,x as ve,y as fe}from"./index-CBxjC3jL.js";import{i as G,A as _e,a as ye,b as ge,c as ke,d as X,e as Y,f as we,g as Ce,h as Ve,j as be}from"./api-Dk0gpnzL.js";import{_ as xe}from"./UploadScore.vue_vue_type_script_setup_true_lang-DTe6bEZG.js";const he={style:{flex:"auto"}},$e=J({__name:"LoginDrawer",props:{status:{type:Function},statusModifiers:{}},emits:["update:status"],setup(M){const g=m(!1),w=m(""),i=m(""),n=m(!1),U=m("修改密码"),c=m("登录"),C=m(G()?"退出":"管理"),v=H(M,"status"),S=()=>{G()?(_e(),C.value="管理",v.value&&v.value(!1)):g.value=!0},x=async()=>{n.value?(await ye(w.value,i.value).catch(T),K("修改成功"),h()):(await ge(w.value).catch(T),K("登录成功"),g.value=!1,C.value="退出",v.value&&v.value(!0))},h=()=>{n.value=!n.value,U.value=n.value?"返回":"修改密码",c.value=n.value?"修改":"登录"},K=(L="更新成功！")=>{O({message:L,type:"success"})},T=async L=>(O({message:"密码错误",type:"error"}),Promise.reject(L));return(L,$)=>{const j=k("el-button"),z=k("el-input"),R=k("el-space"),q=k("el-drawer");return p(),Z(ee,null,[a(j,{type:"warning",class:"global-float-button",onClick:S},{default:o(()=>[D(E(C.value),1)]),_:1}),a(q,{modelValue:g.value,"onUpdate:modelValue":$[2]||($[2]=B=>g.value=B),title:"请先登录!",direction:"btt"},{default:o(()=>[a(R,null,{default:o(()=>[a(z,{type:"password",placeholder:"登录密码",modelValue:w.value,"onUpdate:modelValue":$[0]||($[0]=B=>w.value=B),"show-password":""},null,8,["modelValue"]),n.value?(p(),f(z,{key:0,placeholder:"新密码",modelValue:i.value,"onUpdate:modelValue":$[1]||($[1]=B=>i.value=B)},null,8,["modelValue"])):y("",!0)]),_:1})]),footer:o(()=>[F("div",he,[a(j,{type:"info",onClick:h},{default:o(()=>[D(E(U.value),1)]),_:1}),a(j,{type:"primary",onClick:x},{default:o(()=>[D(E(c.value),1)]),_:1})])]),_:1},8,["modelValue"])],64)}}}),Ne={class:"dialog-footer"},Ae=J({__name:"ConfirmDialog",props:{isVisible:{type:Boolean,default:!1},isVisibleModifiers:{},content:{type:String,default:"请确认"},contentModifiers:{},confirm:{type:Function},confirmModifiers:{}},emits:["update:isVisible","update:content","update:confirm"],setup(M){const g=H(M,"isVisible"),w=H(M,"content"),i=H(M,"confirm"),n=()=>{g.value=!1,i.value&&i.value()};return(U,c)=>{const C=k("el-button"),v=k("el-dialog");return p(),f(v,{modelValue:g.value,"onUpdate:modelValue":c[2]||(c[2]=S=>g.value=S),title:"提醒","align-center":"",center:""},{footer:o(()=>[F("span",Ne,[a(C,{onClick:c[0]||(c[0]=S=>g.value=!1)},{default:o(()=>c[3]||(c[3]=[D("取消")])),_:1}),a(C,{type:"primary",onClick:c[1]||(c[1]=S=>n())},{default:o(()=>c[4]||(c[4]=[D(" 确认 ")])),_:1})])]),default:o(()=>[F("span",null,E(w.value),1)]),_:1},8,["modelValue"])}}}),De=te(Ae,[["__scopeId","data-v-5485ce58"]]),Se={class:"main"},Be={class:"row"},Ie=J({__name:"Main",setup(M){const g={children:"songs",label:"name",class:({category:t})=>t?"song":"category"},w=m(),i=()=>w.value,n=m([]);ae(async()=>{w.value=G(),c()});const U=t=>{w.value=t,t?c():n.value&&(n.value=n.value.filter(e=>e.is_show==1))},c=async()=>{await ke().then(t=>{n.value=t}).catch(P)},C=m(""),v=m();ie(C,t=>{v.value.filter(t)});const S=(t,e)=>t?e.name.includes(t):!0,x=m(""),h=m(""),K=t=>{h.value=t.id,x.value=t.name},T=async(t,e)=>{const u=t.level==1?X:Y,{score:d}=await u(t.data.id,{name:x.value}).catch(P);Q(),e.name=x.value,e.score=d,console.log(e.score),h.value=""},L=async t=>{const e=t.is_show==1?0:1;await X(t.id,{is_show:e}).catch(P),Q(`更新成功，此分类${t.is_show?"将在前台显示":"不再显示"}`),t.is_show=e},$=async(t,e)=>{var _;const u=await we("新目录",e.order_num+1).catch(P);u.songs=[];const d=n.value.findIndex(r=>r.id===e.id);n.value.map(r=>{r.order_num>e.order_num&&(r.order_num+=1)}),n.value.splice(d+1,0,u),n.value=[...n.value],(_=v.value)==null||_.setCurrentKey(u.id)},j=async(t,e)=>{var N,s;const u=t.level===1?1:e.order_num+1,d=e.category||e.name,_=await Ce("新歌曲",d,u).catch(P),r=t.level==1?e.songs:(N=t.parent)==null?void 0:N.data.songs,I=r.findIndex(l=>l.id===e.id);r.map(l=>{l.order_num>e.order_num&&(l.order_num+=1)}),r.splice(I+1,0,_),n.value=[...n.value],(s=v.value)==null||s.setCurrentKey(_.id)},z=m(!1),R=m("确认删除该目录或歌曲？");let q=null;const B=t=>{q=t,R.value=`确认删除【${t.label}】${t.level==1?"及其下所有":""}？`,z.value=!0},le=async(t=q)=>{var _,r,I,N;const e=t.level==1?n.value:(_=t.parent)==null?void 0:_.data.songs;await(t.level==1?Ve:be)(t.data.id).catch(P);const d=e.findIndex(s=>s.id===t.data.id);e.splice(d,1),n.value=[...n.value],e.length?(r=v.value)==null||r.setCurrentKey(e[0].id):(N=v.value)==null||N.setCurrentKey((I=t.parent)==null?void 0:I.id)},ne=async(t,e,u)=>{const d={category:e.data.category||e.data.name,order_num:u!="inner"&&(u=="before"?e.data.order_num:e.data.order_num+1)||void 0};await Y(t.data.id,d)},oe=t=>{var e;return(((e=t.parent)==null?void 0:e.childNodes.length)||0)>1||t.level!=1},se=(t,e,u)=>t.level===e.level?u!=="inner":u==="inner";async function P(t){return O({message:t.msg,type:"warning"}),Promise.reject(t)}function Q(t="更新成功！"){O({message:t,type:"success"})}return(t,e)=>{var N;const u=k("el-input"),d=k("el-button"),_=k("el-text"),r=k("el-space"),I=k("router-link");return p(),Z(ee,null,[a($e,{status:U}),a(De,{isVisible:z.value,content:R.value,confirm:le},null,8,["isVisible","content"]),F("div",Se,[a(u,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),placeholder:"查找歌曲或目录",class:"filter"},null,8,["modelValue"]),a(A(ue),{data:n.value,props:g,"allow-drop":se,"allow-drag":oe,"filter-node-method":S,"expand-on-click-node":!0,"default-expanded-keys":[(N=n.value[0])==null?void 0:N.id],accordion:!i(),"empty-text":"加载中，请稍候...",draggable:"",ref_key:"treeRef",ref:v,"node-key":"id",icon:"a",onNodeDrop:ne},{default:o(({node:s,data:l})=>[F("div",Be,[a(r,null,{default:o(()=>[i()&&!l.category?(p(),f(d,{key:0,type:"warning",link:"",icon:l.is_show==1?A(re):A(ce),onClick:V(b=>L(l),["stop"])},null,8,["icon","onClick"])):y("",!0),a(r,{size:0},{default:o(()=>[h.value!=l.id?(p(),f(_,{key:0,truncated:""},{default:o(()=>[D(E(s.label),1)]),_:2},1024)):y("",!0),i()&&h.value!=l.id?(p(),f(d,{key:1,icon:A(de),type:"primary",link:"",onClick:V(b=>K(l),["stop"])},null,8,["icon","onClick"])):y("",!0),i()&&h.value==l.id?(p(),f(u,{key:2,modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=b=>x.value=b),onInput:x.value,onClick:e[2]||(e[2]=V(()=>{},["stop"])),class:"title"},{append:o(()=>[a(d,{icon:A(pe),onClick:V(b=>T(s,l),["stop"])},null,8,["icon","onClick"])]),_:2},1032,["modelValue","onInput"])):y("",!0)]),_:2},1024)]),_:2},1024),a(r,null,{default:o(()=>[a(r,null,{default:o(()=>[s.level!=1&&!l.score&&i()?(p(),f(xe,{key:0,class:"upload",btnName:i()?"谱":"歌谱",btnType:"info",isBtnLink:!0,onClick:e[3]||(e[3]=V(()=>{},["stop"])),name:l.name,id:l.id,path:l.score,onSuccess:b=>l.score=b},null,8,["btnName","name","id","path","onSuccess"])):y("",!0),s.level!=1&&l.score?(p(),f(I,{key:1,to:{name:"Score",state:{song:{id:l.id,name:l.name,score:l.score}}},onClick:e[4]||(e[4]=V(()=>{},["stop"]))},{default:o(()=>[a(_,{type:"primary"},{default:o(()=>[D(E(i()?"":"歌")+"谱",1)]),_:1})]),_:2},1032,["to"])):y("",!0),s.level!=1&&(i()||l.is_lyrics)?(p(),f(I,{key:2,to:{name:"Lyrics",params:{id:l.id}},onClick:e[5]||(e[5]=V(()=>{},["stop"]))},{default:o(()=>[a(_,{type:l.is_lyrics?"primary":"info"},{default:o(()=>[D(E(i()?"":"歌")+"词",1)]),_:2},1032,["type"])]),_:2},1032,["to"])):y("",!0)]),_:2},1024),i()?(p(),f(r,{key:0},{default:o(()=>{var b;return[s.level==1?(p(),f(d,{key:0,size:"small",type:"primary",icon:A(me),onClick:[W=>$(s,l),e[6]||(e[6]=V(()=>{},["stop"]))]},null,8,["icon","onClick"])):y("",!0),s.level==1&&!s.childNodes.length||s.level==2?(p(),f(d,{key:1,size:"small",type:"success",icon:A(ve),circle:"",onClick:[W=>j(s,l),e[7]||(e[7]=V(()=>{},["stop"]))]},null,8,["icon","onClick"])):y("",!0),s.level!=1||((b=s.parent)==null?void 0:b.childNodes.length)>1?(p(),f(d,{key:2,size:"small",type:"danger",icon:A(fe),circle:"",onClick:[W=>B(s),e[8]||(e[8]=V(()=>{},["stop"]))]},null,8,["icon","onClick"])):y("",!0)]}),_:2},1024)):y("",!0)]),_:2},1024)])]),_:1},8,["data","default-expanded-keys","accordion"])])],64)}}}),Pe=te(Ie,[["__scopeId","data-v-97675c55"]]);export{Pe as default};
