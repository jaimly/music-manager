import{d as P,r as _,u as z,c as W,F as X,a as i,b as C,w as o,o as m,e as A,t as E,f as L,g as se,v as ae,E as T,h as v,_ as Y,i as ie,j as ue,k as S,l as re,m as k,n as w,p as ce,q as de,s as pe,x as me,y as fe,z as ve,A as _e}from"./index-BXZU-0Ea.js";import{i as j,A as ye,a as ge,b as ke,c as J,d as Q,e as Ce,f as we,g as be,h as Ve}from"./api-DkxZQJ3Z.js";import{_ as xe}from"./UploadScore.vue_vue_type_script_setup_true_lang-Dg6bjhbR.js";const $e={style:{flex:"auto"}},he=P({__name:"LoginDrawer",props:{status:{type:Function},statusModifiers:{}},emits:["update:status"],setup(I){const y=_(!1),b=_(!1),x=_(""),d=_(j()?"退出":"管理"),s=z(I,"status");function r(){j()?(ye(),d.value="管理",s.value&&s.value(!1)):y.value=!0}async function g(){await ge(x.value).then(()=>{y.value=!1,b.value=!1,d.value="退出",s.value&&s.value(!0),T({message:"登录成功",type:"success"})}).catch(()=>b.value=!0)}return(B,a)=>{const $=C("el-button"),U=C("el-input"),F=C("el-text"),K=C("el-drawer");return m(),W(X,null,[i($,{type:"warning",class:"global-float-button",onClick:r},{default:o(()=>[A(E(d.value),1)]),_:1}),i(K,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=M=>y.value=M),title:"请先登录!",direction:"btt"},{default:o(()=>[i(U,{type:"password",placeholder:"请输入密码",modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=M=>x.value=M),"show-password":""},null,8,["modelValue"]),se(i(F,{type:"danger"},{default:o(()=>a[2]||(a[2]=[A("密码错误")])),_:1},512),[[ae,b.value]])]),footer:o(()=>[L("div",$e,[i($,{type:"primary",onClick:g},{default:o(()=>a[3]||(a[3]=[A("登录")])),_:1})])]),_:1},8,["modelValue"])],64)}}}),Se={class:"dialog-footer"},Ae=P({__name:"ConfirmDialog",props:{isVisible:{type:Boolean,default:!1},isVisibleModifiers:{},content:{type:String,default:"请确认"},contentModifiers:{},confirm:{type:Function},confirmModifiers:{}},emits:["update:isVisible","update:content","update:confirm"],setup(I){const y=z(I,"isVisible"),b=z(I,"content"),x=z(I,"confirm"),d=()=>{y.value=!1,x.value&&x.value()};return(s,r)=>{const g=C("el-button"),B=C("el-dialog");return m(),v(B,{modelValue:y.value,"onUpdate:modelValue":r[2]||(r[2]=a=>y.value=a),title:"提醒","align-center":"",center:""},{footer:o(()=>[L("span",Se,[i(g,{onClick:r[0]||(r[0]=a=>y.value=!1)},{default:o(()=>r[3]||(r[3]=[A("取消")])),_:1}),i(g,{type:"primary",onClick:r[1]||(r[1]=a=>d())},{default:o(()=>r[4]||(r[4]=[A(" 确认 ")])),_:1})])]),default:o(()=>[L("span",null,E(b.value),1)]),_:1},8,["modelValue"])}}}),De=Y(Ae,[["__scopeId","data-v-5485ce58"]]),Ie={class:"main"},Ne={class:"row"},Me=P({__name:"Main",setup(I){const y={children:"songs",label:"name",class:({category:t})=>t?"song":"category"},b=_(),x=t=>{b.value=t},d=()=>b.value,s=_([]);ie(async()=>{b.value=j(),await ke().then(t=>{s.value=t}).catch(N)});const r=_(""),g=_();ue(r,t=>{g.value.filter(t)});const B=(t,e)=>t?e.name.includes(t):!0,a=_(""),$=_(""),U=t=>{$.value=t.id,a.value=t.name},F=async(t,e)=>{await(t.level==1?J:Q)(t.data.id,{name:a.value}).catch(N),O(),e.name=a.value,$.value=""},K=async t=>{const e=t.is_show==1?0:1;await J(t.id,{is_show:e}).catch(N),O(`更新成功，此分类${t.is_show?"将在前台显示":"不再显示"}`),t.is_show=e},M=async(t,e)=>{var f;const c=await Ce("新目录",e.order_num+1).catch(N);c.songs=[];const p=s.value.findIndex(u=>u.id===e.id);s.value.map(u=>{u.order_num>e.order_num&&(u.order_num+=1)}),s.value.splice(p+1,0,c),s.value=[...s.value],(f=g.value)==null||f.setCurrentKey(c.id)},Z=async(t,e)=>{var h,l;const c=t.level===1?1:e.order_num+1,p=e.category||e.name,f=await we("新歌曲",p,c).catch(N),u=t.level==1?e.songs:(h=t.parent)==null?void 0:h.data.songs,D=u.findIndex(n=>n.id===e.id);u.map(n=>{n.order_num>e.order_num&&(n.order_num+=1)}),u.splice(D+1,0,f),s.value=[...s.value],(l=g.value)==null||l.setCurrentKey(f.id)},R=_(!1),q=_("确认删除该目录或歌曲？");let H=null;const ee=t=>{H=t,q.value=`确认删除【${t.label}】${t.level==1?"及其下所有":""}？`,R.value=!0},te=async(t=H)=>{var f,u,D,h;const e=t.level==1?s.value:(f=t.parent)==null?void 0:f.data.songs;await(t.level==1?be:Ve)(t.data.id).catch(N);const p=e.findIndex(l=>l.id===t.data.id);e.splice(p,1),s.value=[...s.value],e.length?(u=g.value)==null||u.setCurrentKey(e[0].id):(h=g.value)==null||h.setCurrentKey((D=t.parent)==null?void 0:D.id)},ne=async(t,e,c)=>{const p={category:e.data.category||e.data.name,order_num:c!="inner"&&(c=="before"?e.data.order_num:e.data.order_num+1)||void 0};await Q(t.data.id,p)},le=t=>{var e;return(((e=t.parent)==null?void 0:e.childNodes.length)||0)>1||t.level!=1},oe=(t,e,c)=>t.level===e.level?c!=="inner":c==="inner";async function N(t){return T({message:t.msg,type:"warning"}),Promise.reject(t)}function O(t="更新成功！"){T({message:t,type:"success"})}return(t,e)=>{var h;const c=C("el-input"),p=C("el-button"),f=C("el-text"),u=C("el-space"),D=C("router-link");return m(),W(X,null,[i(he,{status:x}),i(De,{isVisible:R.value,content:q.value,confirm:te},null,8,["isVisible","content"]),L("div",Ie,[i(c,{modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value=l),placeholder:"查找歌曲或目录",class:"filter"},null,8,["modelValue"]),i(S(re),{data:s.value,props:y,"allow-drop":oe,"allow-drag":le,"filter-node-method":B,"expand-on-click-node":!0,"default-expanded-keys":[(h=s.value[0])==null?void 0:h.id],accordion:!d(),"empty-text":"加载中，请稍候...",draggable:"",ref_key:"treeRef",ref:g,"node-key":"id",icon:"a",onNodeDrop:ne},{default:o(({node:l,data:n})=>[L("div",Ne,[i(u,null,{default:o(()=>[d()&&!n.category?(m(),v(p,{key:0,type:"warning",link:"",icon:n.is_show==1?S(ce):S(de),onClick:w(V=>K(n),["stop"])},null,8,["icon","onClick"])):k("",!0),i(u,{size:0},{default:o(()=>[$.value!=n.id?(m(),v(f,{key:0,truncated:""},{default:o(()=>[A(E(l.label),1)]),_:2},1024)):k("",!0),d()&&$.value!=n.id?(m(),v(p,{key:1,icon:S(pe),type:"primary",link:"",onClick:w(V=>U(n),["stop"])},null,8,["icon","onClick"])):k("",!0),d()&&$.value==n.id?(m(),v(c,{key:2,modelValue:a.value,"onUpdate:modelValue":e[1]||(e[1]=V=>a.value=V),onInput:a.value,onClick:e[2]||(e[2]=w(()=>{},["stop"])),class:"title"},{append:o(()=>[i(p,{icon:S(me),onClick:w(V=>F(l,n),["stop"])},null,8,["icon","onClick"])]),_:2},1032,["modelValue","onInput"])):k("",!0)]),_:2},1024)]),_:2},1024),i(u,null,{default:o(()=>[i(u,null,{default:o(()=>[l.level!=1&&!n.score&&d()?(m(),v(xe,{key:0,class:"upload",btnName:d()?"谱":"歌谱",btnType:"info",isBtnLink:!0,onClick:e[3]||(e[3]=w(()=>{},["stop"])),name:n.name,id:n.id,onSuccess:V=>n.score=V},null,8,["btnName","name","id","onSuccess"])):k("",!0),l.level!=1&&n.score?(m(),v(D,{key:1,to:{name:"Score",state:{song:{id:n.id,name:n.name,score:n.score}}},onClick:e[4]||(e[4]=w(()=>{},["stop"]))},{default:o(()=>[i(f,{type:"primary"},{default:o(()=>[A(E(d()?"":"歌")+"谱",1)]),_:1})]),_:2},1032,["to"])):k("",!0),l.level!=1?(m(),v(D,{key:2,to:{name:"Lyrics",params:{id:n.id}},onClick:e[5]||(e[5]=w(()=>{},["stop"]))},{default:o(()=>[i(f,{type:"primary"},{default:o(()=>[A(E(d()?"":"歌")+"词",1)]),_:1})]),_:2},1032,["to"])):k("",!0)]),_:2},1024),d()?(m(),v(u,{key:0},{default:o(()=>{var V;return[l.level==1?(m(),v(p,{key:0,size:"small",type:"primary",icon:S(fe),onClick:[G=>M(l,n),e[6]||(e[6]=w(()=>{},["stop"]))]},null,8,["icon","onClick"])):k("",!0),l.level==1&&!l.childNodes.length||l.level==2?(m(),v(p,{key:1,size:"small",type:"success",icon:S(ve),circle:"",onClick:[G=>Z(l,n),e[7]||(e[7]=w(()=>{},["stop"]))]},null,8,["icon","onClick"])):k("",!0),l.level!=1||((V=l.parent)==null?void 0:V.childNodes.length)>1?(m(),v(p,{key:2,size:"small",type:"danger",icon:S(_e),circle:"",onClick:[G=>ee(l),e[8]||(e[8]=w(()=>{},["stop"]))]},null,8,["icon","onClick"])):k("",!0)]}),_:2},1024)):k("",!0)]),_:2},1024)])]),_:1},8,["data","default-expanded-keys","accordion"])])],64)}}}),ze=Y(Me,[["__scopeId","data-v-626973d7"]]);export{ze as default};
