import{d as P,u as B,c as p,w as i,a as U,t as R,b as c,r as w,e as A,o as d,f as b,g as Y,A as Z,h,E as j,i as ee,j as f,k as v,l as S,m as y,n as te,p as le,q as ne,s as oe,v as se,x as ie,F as ae,y as re,z as ue,B as de,C as ce,D as pe,G as me}from"./index-CjTdYM5p.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as fe}from"./UploadScore.vue_vue_type_script_setup_true_lang-DuwQC5xi.js";const ve={class:"dialog-footer"},ye=P({__name:"ConfirmDialog",props:{isVisible:{type:Boolean,default:!1},isVisibleModifiers:{},content:{type:String,default:"请确认"},contentModifiers:{},confirm:{type:Function},confirmModifiers:{}},emits:["update:isVisible","update:content","update:confirm"],setup(I){const x=B(I,"isVisible"),a=B(I,"content"),N=B(I,"confirm"),g=()=>{x.value=!1,N.value&&N.value()};return(T,o)=>{const k=w("el-button"),E=w("el-dialog");return d(),p(E,{modelValue:x.value,"onUpdate:modelValue":o[2]||(o[2]=D=>x.value=D),title:"提醒",width:"30%","align-center":"",center:""},{footer:i(()=>[U("span",ve,[c(k,{onClick:o[0]||(o[0]=D=>x.value=!1)},{default:i(()=>o[3]||(o[3]=[A("取消")])),_:1}),c(k,{type:"primary",onClick:o[1]||(o[1]=D=>g())},{default:i(()=>o[4]||(o[4]=[A(" 确认 ")])),_:1})])]),default:i(()=>[U("span",null,R(a.value),1)]),_:1},8,["modelValue"])}}}),ge=q(ye,[["__scopeId","data-v-a7c6df14"]]),ke={class:"main"},_e=P({__name:"Main",setup(I){const x={children:"songs",label:"name",class:(t,e)=>e.level==1?"category":"song"},a=b([]);Y(async()=>{await Z().then(t=>{a.value=t}).catch($)});const N=b(""),g=b();h(N,t=>{g.value.filter(t)});const T=(t,e)=>t?e.name.includes(t):!0,o=b(""),k=b(""),E=t=>{k.value=t.id,o.value=t.name},D=async(t,e)=>{await(t.level==1?de:ce)(t.data.id,{name:o.value}).catch($),X(),e.name=o.value,k.value=""},G=async(t,e)=>{var u;const r=await re("新目录",e.order_num+1).catch($);r.songs=[];const m=a.value.findIndex(s=>s.id===e.id);a.value.map(s=>{s.order_num>e.order_num&&(s.order_num+=1)}),a.value.splice(m+1,0,r),a.value=[...a.value],(u=g.value)==null||u.setCurrentKey(r.id)},H=async(t,e)=>{var _,l;const r=t.level===1?1:e.order_num+1,m=e.category||e.name,u=await ue("新歌曲",m,r).catch($),s=t.level==1?e.songs:(_=t.parent)==null?void 0:_.data.songs,V=s.findIndex(n=>n.id===e.id);s.map(n=>{n.order_num>e.order_num&&(n.order_num+=1)}),s.splice(V+1,0,u),a.value=[...a.value],(l=g.value)==null||l.setCurrentKey(u.id)},M=b(!1),z=b("确认删除该目录或歌曲？");let K=null;const O=t=>{K=t,z.value=`确认删除【${t.label}】${t.level==1?"及其下所有":""}？`,M.value=!0},L=async(t=K)=>{var u,s,V,_;const e=t.level==1?a.value:(u=t.parent)==null?void 0:u.data.songs;await(t.level==1?pe:me)(t.data.id).catch($);const m=e.findIndex(l=>l.id===t.data.id);e.splice(m,1),a.value=[...a.value],e.length?(s=g.value)==null||s.setCurrentKey(e[0].id):(_=g.value)==null||_.setCurrentKey((V=t.parent)==null?void 0:V.id)},J=(t,e,r,m)=>{},Q=t=>{var e;return(((e=t.parent)==null?void 0:e.childNodes.length)||0)>1||t.level!=1},W=(t,e,r)=>t.level===e.level?r!=="inner":r==="inner";async function $(t){return j({message:t.msg,type:"warning"}),Promise.reject(t)}function X(t="更新成功！"){j({message:t,type:"success"})}return(t,e)=>{var _;const r=w("el-input"),m=w("el-text"),u=w("el-button"),s=w("el-space"),V=w("router-link");return d(),ee(ae,null,[c(ge,{isVisible:M.value,"onUpdate:isVisible":e[0]||(e[0]=l=>M.value=l),content:z.value,"onUpdate:content":e[1]||(e[1]=l=>z.value=l),confirm:L,"onUpdate:confirm":e[2]||(e[2]=l=>L=l)},null,8,["isVisible","content"]),U("div",ke,[c(r,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=l=>N.value=l),placeholder:"查找歌曲或目录",class:"filter"},null,8,["modelValue"]),c(v(ie),{data:a.value,props:x,"allow-drop":W,"allow-drag":Q,"filter-node-method":T,"expand-on-click-node":!0,"default-expanded-keys":[(_=a.value[0])==null?void 0:_.id],draggable:"",accordion:"",ref_key:"treeRef",ref:g,"node-key":"id",onNodeDrop:J},{default:i(({node:l,data:n})=>[c(s,{size:10},{default:i(()=>[c(s,{size:10},{default:i(()=>[c(s,{size:0},{default:i(()=>[k.value!=n.id?(d(),p(m,{key:0,truncated:""},{default:i(()=>[A(R(l.label),1)]),_:2},1024)):f("",!0),v(S)()&&k.value!=n.id?(d(),p(u,{key:1,icon:v(te),type:"text",onClick:y(C=>E(n),["stop"])},null,8,["icon","onClick"])):f("",!0),v(S)()&&k.value==n.id?(d(),p(r,{key:2,modelValue:o.value,"onUpdate:modelValue":e[4]||(e[4]=C=>o.value=C),onInput:o.value,onClick:e[5]||(e[5]=y(()=>{},["stop"])),class:"title"},{append:i(()=>[c(u,{icon:v(le),onClick:y(C=>D(l,n),["stop"])},null,8,["icon","onClick"])]),_:2},1032,["modelValue","onInput"])):f("",!0)]),_:2},1024),c(s,{style:{display:"flex"},size:5},{default:i(()=>[l.level!=1&&!n.score&&v(S)()?(d(),p(fe,{key:0,class:"upload",btnName:"谱",btnType:"info",isBtnLink:!0,onClick:e[6]||(e[6]=y(()=>{},["stop"])),name:n.name,id:n.id,onSuccess:C=>n.score=C},null,8,["name","id","onSuccess"])):f("",!0),l.level!=1&&n.score?(d(),p(V,{key:1,to:{name:"Score",state:{song:{id:n.id,name:n.name,score:n.score}}},onClick:e[7]||(e[7]=y(()=>{},["stop"]))},{default:i(()=>[c(m,{type:"primary"},{default:i(()=>e[12]||(e[12]=[A("谱")])),_:1})]),_:2},1032,["to"])):f("",!0),l.level!=1?(d(),p(V,{key:2,to:{name:"Lyrics",params:{id:n.id}},onClick:e[8]||(e[8]=y(()=>{},["stop"]))},{default:i(()=>[c(m,{type:"primary"},{default:i(()=>e[13]||(e[13]=[A("词")])),_:1})]),_:2},1032,["to"])):f("",!0)]),_:2},1024)]),_:2},1024),v(S)()?(d(),p(s,{key:0},{default:i(()=>{var C;return[l.level==1?(d(),p(u,{key:0,size:"small",type:"primary",icon:v(ne),onClick:[F=>G(l,n),e[9]||(e[9]=y(()=>{},["stop"]))]},null,8,["icon","onClick"])):f("",!0),l.level==1&&!l.childNodes.length||l.level==2?(d(),p(u,{key:1,size:"small",type:"success",icon:v(oe),circle:"",onClick:[F=>H(l,n),e[10]||(e[10]=y(()=>{},["stop"]))]},null,8,["icon","onClick"])):f("",!0),l.level!=1||((C=l.parent)==null?void 0:C.childNodes.length)>1?(d(),p(u,{key:2,size:"small",type:"danger",icon:v(se),circle:"",onClick:[F=>O(l),e[11]||(e[11]=y(()=>{},["stop"]))]},null,8,["icon","onClick"])):f("",!0)]}),_:2},1024)):f("",!0)]),_:2},1024)]),_:1},8,["data","default-expanded-keys"])])],64)}}}),we=q(_e,[["__scopeId","data-v-49618057"]]);export{we as default};
