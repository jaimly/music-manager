import{m as F,n as T,e as L,o as U}from"./api-BOXHtaFG.js";import{d as x,r as y,u as t,g as A,b as g,k as u,E as r,w as v,a as E,e as j,t as D,z as q,o as z}from"./index-DCcT8l5G.js";const P=x({__name:"UploadScore",props:{id:{type:String,required:!0},idModifiers:{},name:{type:String,required:!0},nameModifiers:{},path:{type:String},pathModifiers:{},btnName:{type:String,default:"更换"},btnNameModifiers:{},btnClass:{type:String},btnClassModifiers:{},btnType:{type:String,default:"primary"},btnTypeModifiers:{},isBtnLink:{type:Boolean,default:!1},isBtnLinkModifiers:{},onSuccess:{type:Function},onSuccessModifiers:{}},emits:["update:id","update:name","update:path","update:btnName","update:btnClass","update:btnType","update:isBtnLink","update:onSuccess"],setup(a){const S=y(window.localStorage.getItem("password")),o=y(!1),c=t(a,"id"),d=t(a,"name"),i=t(a,"path"),h=t(a,"btnName"),k=t(a,"btnClass"),w=t(a,"btnType"),M=t(a,"isBtnLink"),p=t(a,"onSuccess"),B=async(e,m,s)=>{var f;if(s.splice(0,1),o.value=!1,e.ok)return l(e);console.log(e.data);const n=(f=e.data)==null?void 0:f.path;i.value||(await L(c.value,{score:n}).catch(async N=>{var b;return await U((b=e.data)==null?void 0:b.id),l(N)}),i.value=n),r({message:"更新成功！",type:"success"}),p.value&&p.value(n)},C=(e,m,s)=>{s.splice(0,1),o.value=!1,console.trace(e),l({msg:`上传失败：${d}`})};function l(e){return r({message:e.msg,type:"error"}),Promise.reject(e)}return(e,m)=>{const s=g("el-button"),n=g("el-upload");return z(),A(n,{action:i.value?u(F)():u(T)(),accept:".jpg,.jpeg,.png",limit:1,"show-file-list":!1,"auto-upload":!0,headers:{password:S.value},data:{id:c.value,name:d.value,category:"score",path:i.value},"on-success":B,"on-error":C,"before-upload":()=>(u(r)({message:"开始上传，请等候...",type:"info"}),o.value=!0,!0)},{default:v(()=>[E(s,{type:w.value,class:q(k.value),link:M.value,disabled:o.value},{default:v(()=>[j(D(h.value),1)]),_:1},8,["type","class","link","disabled"])]),_:1},8,["action","headers","data","before-upload"])}}});export{P as _};
